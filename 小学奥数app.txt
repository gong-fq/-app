import React, { useState, useEffect } from 'react';
import { BookOpen, Lightbulb, Trophy, ChevronRight, RotateCcw, Check, X } from 'lucide-react';

const MathOlympiadApp = () => {
  const [currentLevel, setCurrentLevel] = useState(1);
  const [currentProblem, setCurrentProblem] = useState(0);
  const [showHint, setShowHint] = useState(false);
  const [showSolution, setShowSolution] = useState(false);
  const [userAnswer, setUserAnswer] = useState('');
  const [feedback, setFeedback] = useState(null);
  const [progress, setProgress] = useState({});

  const problems = {
    1: [
      {
        title: "æ‰¾è§„å¾‹ - æ•°å­—åºåˆ—",
        question: "è§‚å¯Ÿæ•°åˆ—ï¼š2, 4, 6, 8, __, 12ã€‚ç©ºæ ¼åº”è¯¥å¡«ä»€ä¹ˆæ•°å­—ï¼Ÿ",
        answer: "10",
        hints: [
          "æç¤º1ï¼šè§‚å¯Ÿç›¸é‚»ä¸¤ä¸ªæ•°å­—ä¹‹é—´çš„å…³ç³»",
          "æç¤º2ï¼šæ¯ä¸ªæ•°å­—å’Œå‰ä¸€ä¸ªæ•°å­—ç›¸å·®å¤šå°‘ï¼Ÿ",
          "æç¤º3ï¼šè¿™æ˜¯ä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼Œå…¬å·®æ˜¯2"
        ],
        solution: {
          thinking: "è§£é¢˜æ€è·¯ï¼š\n1. è§‚å¯Ÿæ•°åˆ—ç‰¹ç‚¹ï¼š2, 4, 6, 8, ?, 12\n2. è®¡ç®—ç›¸é‚»æ•°å­—çš„å·®ï¼š4-2=2, 6-4=2, 8-6=2\n3. å‘ç°è§„å¾‹ï¼šæ¯æ¬¡å¢åŠ 2ï¼ˆç­‰å·®æ•°åˆ—ï¼‰\n4. åº”ç”¨è§„å¾‹ï¼š8+2=10",
          answer: "ç­”æ¡ˆæ˜¯10",
          extension: "ä¸¾ä¸€åä¸‰ï¼š\nâ€¢ å¦‚æœæ•°åˆ—æ˜¯ 3, 6, 9, 12, ?, 18ï¼Œç­”æ¡ˆæ˜¯å¤šå°‘ï¼Ÿï¼ˆ15ï¼‰\nâ€¢ å¦‚æœæ•°åˆ—æ˜¯ 1, 3, 5, 7, ?, 11ï¼Œç­”æ¡ˆæ˜¯å¤šå°‘ï¼Ÿï¼ˆ9ï¼‰"
        },
        difficulty: "åŸºç¡€"
      },
      {
        title: "æ‰¾è§„å¾‹ - å›¾å½¢åºåˆ—",
        question: "ä¸€ä¸ªå›¾å½¢åºåˆ—ä¸­ï¼Œç¬¬1ä¸ªå›¾å½¢æœ‰3ä¸ªä¸‰è§’å½¢ï¼Œç¬¬2ä¸ªæœ‰5ä¸ªä¸‰è§’å½¢ï¼Œç¬¬3ä¸ªæœ‰7ä¸ªä¸‰è§’å½¢ã€‚ç¬¬5ä¸ªå›¾å½¢æœ‰å¤šå°‘ä¸ªä¸‰è§’å½¢ï¼Ÿ",
        answer: "11",
        hints: [
          "æç¤º1ï¼šåˆ—å‡ºå·²çŸ¥ä¿¡æ¯ï¼šç¬¬1ä¸ªâ†’3ä¸ªï¼Œç¬¬2ä¸ªâ†’5ä¸ªï¼Œç¬¬3ä¸ªâ†’7ä¸ª",
          "æç¤º2ï¼šæ¯æ¬¡å¢åŠ å‡ ä¸ªä¸‰è§’å½¢ï¼Ÿ",
          "æç¤º3ï¼šæ‰¾å‡ºæ•°é‡å’Œåºå·çš„å…³ç³»å…¬å¼"
        ],
        solution: {
          thinking: "è§£é¢˜æ€è·¯ï¼š\n1. æ•´ç†æ•°æ®ï¼š\n   ç¬¬1ä¸ªï¼š3ä¸ªä¸‰è§’å½¢\n   ç¬¬2ä¸ªï¼š5ä¸ªä¸‰è§’å½¢\n   ç¬¬3ä¸ªï¼š7ä¸ªä¸‰è§’å½¢\n2. æ‰¾è§„å¾‹ï¼š5-3=2, 7-5=2ï¼ˆæ¯æ¬¡åŠ 2ï¼‰\n3. ç»§ç»­æ¨ç®—ï¼š\n   ç¬¬4ä¸ªï¼š7+2=9ä¸ª\n   ç¬¬5ä¸ªï¼š9+2=11ä¸ª\n4. æˆ–ç”¨å…¬å¼ï¼šç¬¬nä¸ªå›¾å½¢ = 2n+1ä¸ªä¸‰è§’å½¢",
          answer: "ç­”æ¡ˆæ˜¯11ä¸ªä¸‰è§’å½¢",
          extension: "ä¸¾ä¸€åä¸‰ï¼š\nâ€¢ å¦‚æœç¬¬10ä¸ªå›¾å½¢æœ‰å¤šå°‘ä¸ªä¸‰è§’å½¢ï¼Ÿï¼ˆ21ä¸ªï¼‰\nâ€¢ å¦‚æœæŸä¸ªå›¾å½¢æœ‰25ä¸ªä¸‰è§’å½¢ï¼Œå®ƒæ˜¯ç¬¬å‡ ä¸ªï¼Ÿï¼ˆç¬¬12ä¸ªï¼‰"
        },
        difficulty: "åŸºç¡€"
      }
    ],
    2: [
      {
        title: "å·§ç®— - å‡‘æ•´æ³•",
        question: "è®¡ç®—ï¼š37 + 48 + 63 + 52 = ?",
        answer: "200",
        hints: [
          "æç¤º1ï¼šè§‚å¯Ÿè¿™äº›æ•°å­—ï¼Œæœ‰æ²¡æœ‰å¯ä»¥é…å¯¹çš„ï¼Ÿ",
          "æç¤º2ï¼š37å’Œ63ç›¸åŠ ï¼Œ48å’Œ52ç›¸åŠ ",
          "æç¤º3ï¼šé…å¯¹åè®¡ç®—ä¼šæ›´ç®€å•"
        ],
        solution: {
          thinking: "è§£é¢˜æ€è·¯ï¼ˆå‡‘æ•´æ³•ï¼‰ï¼š\n1. è§‚å¯Ÿæ•°å­—ç‰¹ç‚¹ï¼š\n   37 + 63 = 100ï¼ˆå‡‘æˆæ•´ç™¾ï¼‰\n   48 + 52 = 100ï¼ˆå‡‘æˆæ•´ç™¾ï¼‰\n2. é‡æ–°ç»„åˆè®¡ç®—ï¼š\n   (37 + 63) + (48 + 52)\n   = 100 + 100\n   = 200",
          answer: "ç­”æ¡ˆæ˜¯200",
          extension: "ä¸¾ä¸€åä¸‰ï¼š\nâ€¢ è®¡ç®— 25 + 36 + 75 + 64 = ? (200)\nâ€¢ è®¡ç®— 18 + 45 + 82 + 55 = ? (200)\nå…³é”®ï¼šå¯»æ‰¾èƒ½å‡‘æˆæ•´åæˆ–æ•´ç™¾çš„æ•°å¯¹"
        },
        difficulty: "è¿›é˜¶"
      },
      {
        title: "æ¤æ ‘é—®é¢˜",
        question: "åœ¨ä¸€æ¡é•¿100ç±³çš„å°è·¯ä¸€ä¾§æ¤æ ‘ï¼Œæ¯éš”10ç±³ç§ä¸€æ£µï¼ˆä¸¤ç«¯éƒ½ç§ï¼‰ã€‚ä¸€å…±è¦ç§å¤šå°‘æ£µæ ‘ï¼Ÿ",
        answer: "11",
        hints: [
          "æç¤º1ï¼šç”»å›¾ç†è§£ï¼šæ ‘çš„æ•°é‡å’Œé—´éš”æ•°é‡çš„å…³ç³»",
          "æç¤º2ï¼š100ç±³æ¯éš”10ç±³ï¼Œæœ‰å‡ ä¸ªé—´éš”ï¼Ÿ",
          "æç¤º3ï¼šä¸¤ç«¯éƒ½ç§æ ‘ï¼Œæ ‘çš„æ•°é‡ = é—´éš”æ•° + 1"
        ],
        solution: {
          thinking: "è§£é¢˜æ€è·¯ï¼ˆæ¤æ ‘é—®é¢˜-ä¸¤ç«¯éƒ½ç§ï¼‰ï¼š\n1. ç†è§£é¢˜æ„ï¼š\n   æ€»é•¿100ç±³ï¼Œé—´éš”10ç±³ï¼Œä¸¤ç«¯éƒ½ç§\n2. è®¡ç®—é—´éš”æ•°ï¼š\n   100 Ã· 10 = 10ï¼ˆä¸ªé—´éš”ï¼‰\n3. å…³é”®å…¬å¼ï¼š\n   ä¸¤ç«¯éƒ½ç§ï¼šæ ‘æ•° = é—´éš”æ•° + 1\n   10 + 1 = 11ï¼ˆæ£µï¼‰",
          answer: "ç­”æ¡ˆæ˜¯11æ£µæ ‘",
          extension: "ä¸¾ä¸€åä¸‰ï¼š\nâ€¢ å¦‚æœåªç§ä¸€ç«¯ï¼Œéœ€è¦å¤šå°‘æ£µï¼Ÿï¼ˆ10æ£µï¼‰\nâ€¢ å¦‚æœä¸¤ç«¯éƒ½ä¸ç§ï¼Œéœ€è¦å¤šå°‘æ£µï¼Ÿï¼ˆ9æ£µï¼‰\nâ€¢ å¦‚æœæ˜¯å°é—­è·¯çº¿ï¼ˆåœ†å½¢ï¼‰ï¼Œéœ€è¦å¤šå°‘æ£µï¼Ÿï¼ˆ10æ£µï¼‰"
        },
        difficulty: "è¿›é˜¶"
      }
    ],
    3: [
      {
        title: "é¸¡å…”åŒç¬¼",
        question: "ç¬¼å­é‡Œæœ‰é¸¡å’Œå…”å…±20åªï¼Œå…±æœ‰52åªè„šã€‚é—®ç¬¼å­é‡Œæœ‰å¤šå°‘åªé¸¡ï¼Œå¤šå°‘åªå…”ï¼Ÿ",
        answer: "14åªé¸¡ï¼Œ6åªå…”",
        hints: [
          "æç¤º1ï¼šå‡è®¾å…¨æ˜¯é¸¡ï¼Œä¼šæœ‰å¤šå°‘åªè„šï¼Ÿ",
          "æç¤º2ï¼šå®é™…è„šæ•°æ¯”å‡è®¾å¤šäº†å¤šå°‘ï¼Ÿ",
          "æç¤º3ï¼šæ¯åªå…”æ¯”é¸¡å¤š2åªè„šï¼Œå¤šå‡ºçš„è„šæ•°Ã·2å°±æ˜¯å…”æ•°"
        ],
        solution: {
          thinking: "è§£é¢˜æ€è·¯ï¼ˆå‡è®¾æ³•ï¼‰ï¼š\n1. å‡è®¾å…¨æ˜¯é¸¡ï¼š\n   20åªé¸¡åº”æœ‰ï¼š20 Ã— 2 = 40åªè„š\n2. æ¯”è¾ƒå®é™…è„šæ•°ï¼š\n   å®é™…æœ‰52åªè„š\n   å¤šå‡ºï¼š52 - 40 = 12åªè„š\n3. è®¡ç®—å…”å­æ•°ï¼š\n   æ¯åªå…”æ¯”é¸¡å¤šï¼š4 - 2 = 2åªè„š\n   å…”å­æ•°ï¼š12 Ã· 2 = 6åª\n4. è®¡ç®—é¸¡æ•°ï¼š\n   é¸¡æ•°ï¼š20 - 6 = 14åª",
          answer: "ç­”æ¡ˆæ˜¯14åªé¸¡ï¼Œ6åªå…”",
          extension: "ä¸¾ä¸€åä¸‰ï¼š\nâ€¢ å¦‚æœå…±30åªï¼Œ70åªè„šï¼Œå„å¤šå°‘ï¼Ÿï¼ˆ25åªé¸¡ï¼Œ5åªå…”ï¼‰\nâ€¢ å¦‚æœé¸¡å…”å…±15åªï¼Œå…±æœ‰38åªè„šå‘¢ï¼Ÿï¼ˆ11åªé¸¡ï¼Œ4åªå…”ï¼‰\næ‹“å±•ï¼šå¦‚æœè¿˜æœ‰èœ˜è››ï¼ˆ8åªè„šï¼‰æ€ä¹ˆåŠï¼Ÿ"
        },
        difficulty: "æŒ‘æˆ˜"
      },
      {
        title: "å¹´é¾„é—®é¢˜",
        question: "çˆ¸çˆ¸ä»Šå¹´36å²ï¼Œå„¿å­ä»Šå¹´8å²ã€‚å‡ å¹´åçˆ¸çˆ¸çš„å¹´é¾„æ˜¯å„¿å­çš„3å€ï¼Ÿ",
        answer: "6å¹´å",
        hints: [
          "æç¤º1ï¼šå¹´é¾„å·®æ°¸è¿œä¸å˜",
          "æç¤º2ï¼šè®¡ç®—ç°åœ¨çš„å¹´é¾„å·®ï¼š36 - 8 = 28å²",
          "æç¤º3ï¼šå½“çˆ¸çˆ¸æ˜¯å„¿å­3å€æ—¶ï¼Œå¹´é¾„å·®æ˜¯å„¿å­å¹´é¾„çš„2å€"
        ],
        solution: {
          thinking: "è§£é¢˜æ€è·¯ï¼ˆå¹´é¾„é—®é¢˜æ ¸å¿ƒï¼šå¹´é¾„å·®ä¸å˜ï¼‰ï¼š\n1. æ‰¾å‡ºå¹´é¾„å·®ï¼š\n   36 - 8 = 28å²ï¼ˆå·®å€¼ä¸å˜ï¼‰\n2. ç†è§£å€æ•°å…³ç³»ï¼š\n   å½“çˆ¸çˆ¸æ˜¯å„¿å­3å€æ—¶ï¼š\n   çˆ¸çˆ¸ = å„¿å­ Ã— 3\n   å·® = å„¿å­ Ã— 3 - å„¿å­ = å„¿å­ Ã— 2\n3. è®¡ç®—é‚£æ—¶å„¿å­å¹´é¾„ï¼š\n   28 Ã· 2 = 14å²\n4. è®¡ç®—éœ€è¦å‡ å¹´ï¼š\n   14 - 8 = 6å¹´",
          answer: "ç­”æ¡ˆæ˜¯6å¹´å",
          extension: "ä¸¾ä¸€åä¸‰ï¼š\nâ€¢ å‡ å¹´åçˆ¸çˆ¸å¹´é¾„æ˜¯å„¿å­çš„2å€ï¼Ÿï¼ˆ20å¹´åï¼‰\nâ€¢ å‡ å¹´å‰çˆ¸çˆ¸å¹´é¾„æ˜¯å„¿å­çš„5å€ï¼Ÿï¼ˆ2å¹´å‰ï¼‰\nâ€¢ å¦‚æœå¦ˆå¦ˆä»Šå¹´32å²ï¼Œä½•æ—¶ä¸‰äººå¹´é¾„å’Œæ˜¯100ï¼Ÿ"
        },
        difficulty: "æŒ‘æˆ˜"
      }
    ]
  };

  useEffect(() => {
    const savedProgress = JSON.parse(localStorage.getItem('mathProgress') || '{}');
    setProgress(savedProgress);
  }, []);

  const saveProgress = (level, problemIndex, correct) => {
    const key = `${level}-${problemIndex}`;
    const newProgress = { ...progress, [key]: correct };
    setProgress(newProgress);
    localStorage.setItem('mathProgress', JSON.stringify(newProgress));
  };

  const checkAnswer = () => {
    const problem = problems[currentLevel][currentProblem];
    const correct = userAnswer.trim().toLowerCase() === problem.answer.toLowerCase() ||
                    userAnswer.trim() === problem.answer;
    
    setFeedback(correct);
    if (correct) {
      saveProgress(currentLevel, currentProblem, true);
    }
  };

  const resetProblem = () => {
    setUserAnswer('');
    setFeedback(null);
    setShowHint(false);
    setShowSolution(false);
  };

  const nextProblem = () => {
    const levelProblems = problems[currentLevel];
    if (currentProblem < levelProblems.length - 1) {
      setCurrentProblem(currentProblem + 1);
      resetProblem();
    }
  };

  const prevProblem = () => {
    if (currentProblem > 0) {
      setCurrentProblem(currentProblem - 1);
      resetProblem();
    }
  };

  const problem = problems[currentLevel][currentProblem];

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4">
      <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <Trophy className="w-8 h-8 text-yellow-500" />
              <div>
                <h1 className="text-2xl font-bold text-gray-800">å°å­¦æ•°å­¦å¥¥èµ›è¾…å¯¼</h1>
                <p className="text-sm text-gray-600">åŸ¹å…»æ•°å­¦æ€ç»´ï¼Œæå‡è§£é¢˜èƒ½åŠ›</p>
              </div>
            </div>
            <div className="text-right">
              <p className="text-sm text-gray-600">å½“å‰çº§åˆ«</p>
              <p className="text-xl font-bold text-purple-600">Level {currentLevel}</p>
            </div>
          </div>
        </div>

        {/* Level Selection */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <h2 className="text-lg font-semibold mb-4 flex items-center gap-2">
            <BookOpen className="w-5 h-5 text-blue-500" />
            é€‰æ‹©éš¾åº¦çº§åˆ«
          </h2>
          <div className="grid grid-cols-3 gap-3">
            {[1, 2, 3].map(level => (
              <button
                key={level}
                onClick={() => {
                  setCurrentLevel(level);
                  setCurrentProblem(0);
                  resetProblem();
                }}
                className={`p-4 rounded-lg font-medium transition-all ${
                  currentLevel === level
                    ? 'bg-purple-500 text-white shadow-md'
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
              >
                {level === 1 && 'åŸºç¡€å…¥é—¨'}
                {level === 2 && 'è¿›é˜¶æå‡'}
                {level === 3 && 'æŒ‘æˆ˜å†²åˆº'}
              </button>
            ))}
          </div>
        </div>

        {/* Problem Card */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <div className="flex justify-between items-start mb-4">
            <div>
              <span className="inline-block px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium mb-2">
                {problem.difficulty}
              </span>
              <h2 className="text-xl font-bold text-gray-800">{problem.title}</h2>
            </div>
            <div className="text-sm text-gray-500">
              é¢˜ç›® {currentProblem + 1} / {problems[currentLevel].length}
            </div>
          </div>

          <div className="bg-blue-50 rounded-lg p-4 mb-6">
            <p className="text-lg text-gray-800 leading-relaxed">{problem.question}</p>
          </div>

          {/* Answer Input */}
          <div className="mb-6">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              ä½ çš„ç­”æ¡ˆï¼š
            </label>
            <input
              type="text"
              value={userAnswer}
              onChange={(e) => setUserAnswer(e.target.value)}
              placeholder="åœ¨è¿™é‡Œè¾“å…¥ç­”æ¡ˆ..."
              className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
            />
          </div>

          {/* Feedback */}
          {feedback !== null && (
            <div className={`mb-6 p-4 rounded-lg flex items-center gap-3 ${
              feedback ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'
            }`}>
              {feedback ? <Check className="w-6 h-6" /> : <X className="w-6 h-6" />}
              <span className="font-medium">
                {feedback ? 'å›ç­”æ­£ç¡®ï¼åšå¾—å¾ˆå¥½ï¼' : 'ç­”æ¡ˆä¸å¯¹ï¼Œå†æƒ³æƒ³çœ‹æˆ–æŸ¥çœ‹æç¤º'}
              </span>
            </div>
          )}

          {/* Action Buttons */}
          <div className="flex gap-3 mb-6">
            <button
              onClick={checkAnswer}
              disabled={!userAnswer.trim()}
              className="flex-1 bg-purple-500 text-white py-3 rounded-lg font-medium hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all"
            >
              æäº¤ç­”æ¡ˆ
            </button>
            <button
              onClick={() => setShowHint(!showHint)}
              className="px-6 py-3 bg-yellow-500 text-white rounded-lg font-medium hover:bg-yellow-600 transition-all flex items-center gap-2"
            >
              <Lightbulb className="w-5 h-5" />
              æç¤º
            </button>
            <button
              onClick={resetProblem}
              className="px-6 py-3 bg-gray-500 text-white rounded-lg font-medium hover:bg-gray-600 transition-all"
            >
              <RotateCcw className="w-5 h-5" />
            </button>
          </div>

          {/* Hints */}
          {showHint && (
            <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
              <h3 className="font-semibold text-yellow-800 mb-2">ğŸ’¡ è§£é¢˜æç¤ºï¼š</h3>
              {problem.hints.map((hint, idx) => (
                <p key={idx} className="text-yellow-700 mb-1">{hint}</p>
              ))}
            </div>
          )}

          {/* Solution */}
          <div className="border-t pt-6">
            <button
              onClick={() => setShowSolution(!showSolution)}
              className="w-full py-3 bg-blue-100 text-blue-700 rounded-lg font-medium hover:bg-blue-200 transition-all"
            >
              {showSolution ? 'éšè—è§£æ' : 'æŸ¥çœ‹è¯¦ç»†è§£æ'}
            </button>

            {showSolution && (
              <div className="mt-4 space-y-4">
                <div className="bg-green-50 rounded-lg p-4">
                  <h3 className="font-semibold text-green-800 mb-2">ğŸ¯ è§£é¢˜æ€è·¯ï¼š</h3>
                  <pre className="text-green-700 whitespace-pre-wrap font-sans">
                    {problem.solution.thinking}
                  </pre>
                </div>

                <div className="bg-blue-50 rounded-lg p-4">
                  <h3 className="font-semibold text-blue-800 mb-2">âœ… {problem.solution.answer}</h3>
                </div>

                <div className="bg-purple-50 rounded-lg p-4">
                  <h3 className="font-semibold text-purple-800 mb-2">ğŸš€ ä¸¾ä¸€åä¸‰ï¼š</h3>
                  <pre className="text-purple-700 whitespace-pre-wrap font-sans">
                    {problem.solution.extension}
                  </pre>
                </div>
              </div>
            )}
          </div>
        </div>

        {/* Navigation */}
        <div className="flex justify-between gap-4">
          <button
            onClick={prevProblem}
            disabled={currentProblem === 0}
            className="px-6 py-3 bg-gray-500 text-white rounded-lg font-medium hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all"
          >
            ä¸Šä¸€é¢˜
          </button>
          <button
            onClick={nextProblem}
            disabled={currentProblem === problems[currentLevel].length - 1}
            className="px-6 py-3 bg-purple-500 text-white rounded-lg font-medium hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all flex items-center gap-2"
          >
            ä¸‹ä¸€é¢˜
            <ChevronRight className="w-5 h-5" />
          </button>
        </div>
      </div>
    </div>
  );
};

export default MathOlympiadApp;